<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Analyse G√©n√©rale</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
</head>
<body>
  <h1>Analyse G√©n√©rale</h1>
  <canvas id="generalChart" width="800" height="400"></canvas>

  <section id="interpretation">
    <h2>Interpr√©tation des Donn√©es</h2>
    <p id="interpretation-text">Chargement des donn√©es...</p>
  </section>

  <script>
    // Configuration Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAQR6SPQmcR_VB4iMyb5kdr-CFCgnsBp6Q",
      authDomain: "fire-detection-aafdc.firebaseapp.com",
      databaseURL: "https://fire-detection-aafdc-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "fire-detection-aafdc",
      storageBucket: "fire-detection-aafdc.firebasestorage.app",
      messagingSenderId: "866669467002",
      appId: "1:866669467002:web:2139a073556a7527afb2c3"
    };

    // Initialisation Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const sensorsRef = database.ref('sensor');

    // Configuration du graphique
    const ctx = document.getElementById('generalChart').getContext('2d');
    const generalChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: [], // √âtiquettes de temps
        datasets: [
          {
            label: 'Temp√©rature (¬∞C)',
            data: [],
            borderColor: 'rgba(255, 99, 132, 1)', // Rouge
            borderWidth: 2,
            fill: false
          },
          {
            label: 'Humidit√© (%)',
            data: [],
            borderColor: 'rgba(54, 162, 235, 1)', // Bleu
            borderWidth: 2,
            fill: false
          },
          {
            label: 'CO (ppm)',
            data: [],
            borderColor: 'rgba(255, 159, 64, 1)', // Orange
            borderWidth: 2,
            fill: false
          },
          {
            label: 'CO2 (ppm)',
            data: [],
            borderColor: 'rgba(75, 192, 192, 1)', // Turquoise
            borderWidth: 2,
            fill: false
          }
        ]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });

    // Fonction pour mettre √† jour l'interpr√©tation
    function updateInterpretation(temp, humidity, co, co2) {
      const interpretationText = document.getElementById('interpretation-text');
      let message = "";

      // Interpr√©tation pour la temp√©rature
      if (temp > 50) {
        message += "‚ö†Ô∏è <strong>Temp√©rature critique</strong> : Danger d'incendie. √âvacuation imm√©diate requise!.<br>";
      } else if (temp > 30) {
        message += "üå°Ô∏è <strong>Temp√©rature √©lev√©e</strong> : Surveillez la situation.<br>";
      } else {
        message += "üå°Ô∏è <strong>Temp√©rature normale</strong> : Aucun risque d√©tect√©.<br>";
      }

      // Interpr√©tation pour l'humidit√©
      if (humidity > 60) {
        message += "üíß <strong>Humidit√© √©lev√©e</strong> : Risque de moisissure. A√©rez la zone.<br>";
      } else if (humidity < 30) {
        message += "üíß <strong>Air sec</strong> : Risque d'incendie accru. Surveillez la situation.<br>";
      } else {
        message += "üíß <strong>Humidit√© normale</strong> : Conditions optimales.<br>";
      }

      // Interpr√©tation pour le CO
      if (co > 35) {
        message += "‚ò†Ô∏è <strong>CO √©lev√©</strong> : Danger pour la sant√©. √âvacuation imm√©diate.<br>";
      } else if (co > 10) {
        message += "‚ö†Ô∏è <strong>CO mod√©r√©</strong> : A√©rez la zone.<br>";
      } else {
        message += "‚úÖ <strong>CO normal</strong> : Aucun danger.<br>";
      }

      // Interpr√©tation pour le CO2
      if (co2 > 2000) {
        message += "üí® <strong>CO2 √©lev√©</strong> : Air vici√©. A√©rez imm√©diatement.<br>";
      } else if (co2 > 1000) {
        message += "‚ö†Ô∏è <strong>CO2 mod√©r√©</strong> : A√©ration recommand√©e.<br>";
      } else {
        message += "‚úÖ <strong>CO2 normal</strong> : Air sain.<br>";
      }

      interpretationText.innerHTML = message;
    }

    // √âcoute des donn√©es en temps r√©el
    sensorsRef.on('value', (snapshot) => {
      if (snapshot.exists()) {
        const data = snapshot.val();

        // Ajouter les nouvelles donn√©es au graphique
        const newLabels = generalChart.data.labels;
        const newTempData = generalChart.data.datasets[0].data;
        const newHumidityData = generalChart.data.datasets[1].data;
        const newCOData = generalChart.data.datasets[2].data;
        const newCO2Data = generalChart.data.datasets[3].data;

        newLabels.push(new Date().toLocaleTimeString()); // Heure actuelle
        newTempData.push(data.temp); // Temp√©rature
        newHumidityData.push(data.humidite); // Humidit√©
        newCOData.push(data.co); // CO
        newCO2Data.push(data.co2); // CO2

        // Limiter le nombre de points affich√©s
        if (newLabels.length > 10) {
          newLabels.shift();
          newTempData.shift();
          newHumidityData.shift();
          newCOData.shift();
          newCO2Data.shift();
        }

        // Mettre √† jour le graphique
        generalChart.update();

        // Mettre √† jour l'interpr√©tation
        updateInterpretation(data.temp, data.humidite, data.co, data.co2);
      } else {
        console.error("Aucune donn√©e trouv√©e dans Firebase.");
      }
    });
  </script>
</body>
</html>